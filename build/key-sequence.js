// Generated by CoffeeScript 1.10.0
(function() {
  var KeyKit, KeySequence, _,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  _ = require('underscore-plus');

  KeyKit = require('./keykit');

  module.exports = KeySequence = (function() {
    KeySequence.prototype.callbackReference = null;

    KeySequence.prototype.keys = null;

    KeySequence.prototype.running = null;

    function KeySequence(sequence) {
      this.execute = bind(this.execute, this);
      this.keys = KeyKit.getKeystrokes(sequence);
      this.running = false;
    }

    KeySequence.prototype.execute = function(event) {
      var ref;
      if (this.running) {
        return;
      }
      this.running = true;
      if (event != null) {
        event = (ref = event.originalEvent) != null ? ref : event;
        event.preventDefault();
        event.stopImmediatePropagation();
      }
      _.each(this.keys, this.trigger.bind(this));
      return this.running = false;
    };

    KeySequence.prototype.trigger = function(key) {
      var base, canceled, downEvent, textEvent;
      downEvent = KeyKit.createKBEvent('keydown', key);
      canceled = !this.dispatch(downEvent);
      if (!canceled) {
        if (this.dispatch(textEvent = KeyKit.createTextEvent(key))) {
          if (typeof (base = document.activeElement).getModel === "function") {
            base.getModel().insertText(key.char);
          }
        }
      }
      return this.dispatch(KeyKit.createKBEvent('keyup', key));
    };

    KeySequence.prototype.getCallback = function() {
      if (this.callbackReference == null) {
        this.callbackReference = this.execute.bind(this);
      }
      return this.callbackReference;
    };

    KeySequence.prototype.dispatch = function(event) {
      return document.activeElement.dispatchEvent(event);
    };

    return KeySequence;

  })();

}).call(this);
